flowchart TD
    Start([Start]) --> L1[Load Markdown File(s)]
    L1 --> P1[Extract/Select Panel(s)]
    P1 --> LoopPanels{For Each Panel}
    LoopPanels --> PC[Parse Panel Content]
    PC --> THEME[LLM: Analyze Scene Theme]
    THEME --> ROLES[LLM: Define Required Roles]
    ROLES --> REWRITE[LLM: Rewrite Scene with Roles]
    REWRITE --> CHECK[LLM: Checklist Evaluation]
    CHECK --> PassOK{Passes Checklist?}
    PassOK -- No --> REWRITE
    PassOK -- Yes --> CHAR[Enhance Characters]
    CHAR --> SPEECH[LLM: Generate Speech Bubbles]
    SPEECH --> ASSEMBLE[Assemble Enhanced JSON Panel]
    ASSEMBLE --> LoopPanels
    LoopPanels --> END([Save All Enhanced Panels])